.. _worksheet5:

Worksheet 5: Expected Value and Variance
========================================

.. admonition:: Learning Objectives ðŸŽ¯
   :class: info

   â€¢ Calculate expected values for discrete random variables
   â€¢ Apply the Law of the Unconscious Statistician (LOTUS)
   â€¢ Use linearity of expectation for transformed random variables
   â€¢ Compute variance and understand its properties
   â€¢ Analyze sums of random variables (expected value and variance)
   â€¢ Work with joint probability mass functions and covariance

Introduction
------------

The **expected value** is a fundamental concept in probability and statistics that represents the long-term average or mean value of a random variable. It tells you what you can expect to happen on average if you repeat a random process many times. 

For a discrete random variable :math:`X` that takes values in a countable set :math:`\text{Supp} = \{x \in \mathbb{R} | P(X = x) > 0\}` known as the support of the random variable :math:`X`, the expected value of :math:`X`, denoted as :math:`E[X]` or sometimes :math:`\mu` is defined as:

.. math::
   E[X] = \sum_{x \in \text{Supp}} x \cdot P(X = x)

provided the sum converges absolutely, that is:

.. math::
   \sum_{x \in \text{Supp}} |x| \cdot P(X = x) < \infty

In this definition it is clear that :math:`E[X]` is simply a weighted average of each outcome of the random variable where the weights are given by its probability of occurrence.

Part 1: Expected Value and LOTUS
--------------------------------

Often, we are not only interested in the random variable :math:`X` itself but also in functions of :math:`X`. If :math:`g: \mathbb{R} \to \mathbb{R}` is any function, then :math:`g(X)` is a new random variable. Its expected value is given by the **Law of the Unconscious Statistician (LOTUS)**:

.. math::
   E[g(X)] = \sum_{x \in \text{Supp}} g(x) \cdot P(X = x)

**Specific Functions of Interest:**

- **Identity Function** (:math:`g(x) = x`): This recovers the definition of the expected value of :math:`X`
- **Linear Function** (:math:`g(x) = ax + b`, where :math:`a \neq 0`): This function is particularly important because of the linearity property of expectation
  
  - **Linearity of Expectation:** For a linear transformation of :math:`X`, the expected value is given by :math:`E[aX + b] = aE[X] + b`. In general, the expected value does not commute with the function i.e., :math:`E[g(X)] \neq g(E[X])`

- **Square Function** (:math:`g(x) = x^2`): This is used to compute what is known as the second moment of :math:`X`, and is important for determining the variance of :math:`X`
- **Squared Deviation Function** (:math:`g(x) = (x - E[X])^2`): This function directly leads to the definition of variance, measuring the dispersion/spread of :math:`X` around its mean
- **Indicator Function** (:math:`g(x) = \mathbf{1}_A(x)`, where :math:`\mathbf{1}_A(x) = 1` if :math:`x \in A` and :math:`0` if :math:`x \notin A`): Its expected value gives the probability i.e., :math:`E[\mathbf{1}_A(X)] = P(X \in A)`

The indicator function is typically written using the notation:

.. math::
   \mathbf{1}_A(x) = \begin{cases}
   1 & \text{if } x \in A \\
   0 & \text{if } x \notin A
   \end{cases}

**Question 1:** In a distant galaxy, treasure hunters search for magical chests containing three coins. Each coin is selected independently from a set of two denominations with the following values and probabilities:

- Gold Coin: 100 units (probability 0.2)
- Silver Coin: 20 units (probability 0.8)

Let :math:`X` be the random variable representing the total monetary value of the three coins drawn from the chest.

a) Complete the table for the probability mass function of this random variable :math:`X`.

.. table:: PMF of Total Value
   :align: center

   +-------+------+------+------+------+
   | x     | 60   | 140  | 220  | 300  |
   +=======+======+======+======+======+
   | pâ‚“(x) |      |      |      |      |
   +-------+------+------+------+------+

b) Determine the expected value of :math:`X`. The expected value :math:`E[X]` represents the average total value of the coins collected from a chest, based on repeated sampling of many chests over time.

c) During the Festival of Stars, treasure hunters receive a special time-limited bonus when opening enchanted chests. During this period, the total monetary value of the coins is increased according to the following rule:

   The new total value, represented by the random variable :math:`Y`, is given by the equation:
   
   .. math::
      Y = 2X + 30

   Using linearity of expectation determine the expected value of the new random variable :math:`Y`.

d) Treasure hunters sometimes pay a magical tax when they open a chest. This tax, represented by the random variable :math:`T(X)`, where the tax is defined as:

   .. math::
      T(x) = \begin{cases}
      0.1x & \text{if } x > 200 \\
      5 & \text{if } x \leq 200
      \end{cases}

   Use the Law of Unconscious Statistician and the idea of indicator functions to determine the expected value of the magical tax. Start by writing out :math:`T(X)` using the indicator function :math:`\mathbf{1}_A(x) = \begin{cases} 1 & \text{if } x > 200 \\ 0 & \text{if } x \leq 200 \end{cases}` and then compute the expected value of :math:`T(X)`.

**R Code for Calculations:**

.. code-block:: r

   # Define coin probabilities
   p_gold <- 0.2
   p_silver <- 0.8
   
   # Calculate PMF for 3 coins
   # Possible outcomes: 0, 1, 2, or 3 gold coins
   n_gold <- 0:3
   n_silver <- 3 - n_gold
   
   # Values for each outcome
   values <- n_gold * 100 + n_silver * 20
   
   # Probabilities using binomial
   probs <- dbinom(n_gold, size = 3, prob = p_gold)
   
   # Create PMF table
   pmf_data <- data.frame(
     x = values,
     p_X = probs
   )
   
   print("PMF of X:")
   print(pmf_data)
   
   # Calculate E[X]
   E_X <- sum(pmf_data$x * pmf_data$p_X)
   cat("\nE[X] =", E_X, "\n")
   
   # Festival bonus: Y = 2X + 30
   E_Y <- 2 * E_X + 30
   cat("E[Y] = E[2X + 30] =", E_Y, "\n")
   
   # Tax calculation using indicator function
   tax_function <- function(x) {
     ifelse(x > 200, 0.1 * x, 5)
   }
   
   E_tax <- sum(tax_function(pmf_data$x) * pmf_data$p_X)
   cat("E[T(X)] =", E_tax, "\n")

Part 2: Variance and Its Properties
------------------------------------

While the expected value tells us the long-term average outcome, variance measures the dispersion or spread of a random variable around its average.

For a random variable :math:`X` with finite expected value :math:`E[X]`, the variance is defined as:

.. math::
   \text{Var}(X) = E[(X - E[X])^2] = \sum_{x \in \text{Supp}} (x - E[X])^2 \cdot P(X = x)

This definition represents the average of the squared deviations from the mean. It quantifies how much the outcomes of :math:`X` differ from the expected value. An equivalent (and often more convenient) formula for variance is:

.. math::
   \text{Var}(X) = E[X^2] - (E[X])^2

**Properties of Variance:**

- **Non-Negativity:** Variance is always non-negative: :math:`\text{Var}(X) \geq 0`. It equals zero if and only if :math:`X` is a constant
- **Scaling:** For any constant :math:`a \neq 0`, :math:`\text{Var}(aX) = a^2\text{Var}(X)`. If you scale a random variable, its variance is scaled by the square of the constant
- **Translation:** For any constant :math:`b`, :math:`\text{Var}(X + b) = \text{Var}(X)`. If you shift a random variable by a constant it does not change the variance

**Question 2:** Continuing with the treasure hunter example above where :math:`X` is a random variable representing the total monetary value of the three coins drawn from the chest.

a) Determine the variance of :math:`X`.

b) Determine the variance of the total monetary value of a random chest during the bonus round period during the Festival of Stars event, i.e., :math:`Y = 2X + 30`.

c) Using the equivalent formula for variance :math:`\text{Var}(X) = E[X^2] - (E[X])^2` determine the variance of the magical treasure chest tax :math:`T(X)` as defined in question 1. Start by figuring out what :math:`[T(X)]^2` looks like as a function, think about what the square of an indicator function would be.

**R Code for Variance Calculations:**

.. code-block:: r

   # Calculate E[X^2]
   E_X2 <- sum(pmf_data$x^2 * pmf_data$p_X)
   
   # Variance of X
   Var_X <- E_X2 - E_X^2
   cat("Var(X) =", Var_X, "\n")
   cat("SD(X) =", sqrt(Var_X), "\n")
   
   # Variance of Y = 2X + 30
   Var_Y <- 4 * Var_X  # Using Var(aX + b) = a^2 * Var(X)
   cat("\nVar(Y) = Var(2X + 30) =", Var_Y, "\n")
   
   # For tax variance, first find E[T(X)^2]
   tax_squared <- function(x) {
     tax_function(x)^2
   }
   
   E_tax2 <- sum(tax_squared(pmf_data$x) * pmf_data$p_X)
   Var_tax <- E_tax2 - E_tax^2
   cat("\nVar(T(X)) =", Var_tax, "\n")

Part 3: Sums of Random Variables
---------------------------------

When working with multiple random variables, we often need to determine the expected value of their sum or difference. The additivity property of expected value allows us to handle this efficiently.

**Additivity of Expected Values:**

For :math:`n` random variables :math:`X_1, X_2, \ldots, X_n`, the expected value of their sum or difference is given by:

.. math::
   E[X_1 \pm X_2 \pm \cdots \pm X_n] = E[X_1] \pm E[X_2] \pm \cdots \pm E[X_n]

This property holds as long as the expected values of all random variables exist and converge absolutely. It does not require any special relationships (e.g., independence) between the random variables.

While expected value provides the long-term average, variance measures how much a random variable tends to deviate from its mean. For multiple random variables, we can determine how their variances combine under different conditions.

For :math:`n` random variables :math:`X_1, X_2, \ldots, X_n`, the variance of their sum or difference will depend on if the random variables are independent or not. If they are dependent the variance of their sum is given by:

.. math::
   \text{Var}(X_1 + X_2 + \cdots + X_n) = \sum_{i=1}^n \text{Var}(X_i) + 2\sum_{i=1}^n \sum_{j>i} \text{Cov}(X_i, X_j)

where

.. math::
   \text{Cov}(X_i, X_j) = E[X_i X_j] - E[X_i]E[X_j]

If the random variables are independent, the covariance terms are zero, simplifying the formula to:

.. math::
   \text{Var}(X_1 \pm X_2 \pm \cdots \pm X_n) = \text{Var}(X_1) + \text{Var}(X_2) + \cdots + \text{Var}(X_n)

This simplification highlights that, under independence, the variance of the sum (or difference) of random variables is simply the sum of their individual variances.

**Question 3:** Now suppose the treasure hunters collect coins from two independent chests, represented by :math:`X_1` and :math:`X_2`, where each :math:`X_i` is the total monetary value of coins from one chest. We can use the properties of variance and expected value to analyze this scenario.

a) Determine the expected value of :math:`Y = X_1 + X_2` which represents the expected total value of the coins collected from two chests, based on repeated sampling of two chests over time.

b) Determine the standard deviation of :math:`Y = X_1 + X_2`.

Part 4: Joint Probability Mass Functions
-----------------------------------------

The probability of two discrete random variables :math:`X` and :math:`Y` is defined jointly and called the **joint probability mass function**.

**Symbolic Representation:** :math:`p_{X,Y}(x, y) = P(\{X = x\} \cap \{Y = y\})`

**Question 4:** The following is a joint probability mass function for two random variables :math:`X` and :math:`Y`.

.. table:: Joint PMF Table
   :align: center

   +-------+----------------+----------------+----------------+----------------+
   | x, y  | 1              | 2              | 3              | 4              |
   +=======+================+================+================+================+
   | 1     | pâ‚“,áµ§(1,1) =    | pâ‚“,áµ§(1,2) =    | pâ‚“,áµ§(1,3) =    | pâ‚“,áµ§(1,4) =    |
   |       | 1/144          | 1/72           | 1/288          | 41/288         |
   +-------+----------------+----------------+----------------+----------------+
   | 2     | pâ‚“,áµ§(2,1) =    | pâ‚“,áµ§(2,2) =    | pâ‚“,áµ§(2,3) =    | pâ‚“,áµ§(2,4) =    |
   |       | 1/144          | 93/144         | 1/144          | 1/144          |
   +-------+----------------+----------------+----------------+----------------+
   | 3     | pâ‚“,áµ§(3,1) =    | pâ‚“,áµ§(3,2) =    | pâ‚“,áµ§(3,3) =    | pâ‚“,áµ§(3,4) =    |
   |       | 1/144          | 1/72           | 1/288          | 41/288         |
   +-------+----------------+----------------+----------------+----------------+

*Worksheet #4 may help with answering the following questions.*

a) Determine the expected value of :math:`X`.

b) Determine the expected value for :math:`Y`.

c) Determine the expected value of :math:`Z = X + Y`.

d) Determine the expected value of the product of :math:`X` and :math:`Y`, i.e., :math:`V = XY`.

e) Determine the covariance of :math:`X` and :math:`Y`.

f) Finally determine the variance :math:`Z = X + Y`.

**R Code for Joint PMF Analysis:**

.. code-block:: r

   # Create joint PMF matrix
   joint_pmf <- matrix(c(
     1/144, 1/72, 1/288, 41/288,
     1/144, 93/144, 1/144, 1/144,
     1/144, 1/72, 1/288, 41/288
   ), nrow = 3, byrow = TRUE)
   
   rownames(joint_pmf) <- 1:3
   colnames(joint_pmf) <- 1:4
   
   # Calculate marginal distributions
   marginal_X <- rowSums(joint_pmf)
   marginal_Y <- colSums(joint_pmf)
   
   # Expected values
   E_X <- sum((1:3) * marginal_X)
   E_Y <- sum((1:4) * marginal_Y)
   cat("E[X] =", E_X, "\n")
   cat("E[Y] =", E_Y, "\n")
   cat("E[X + Y] =", E_X + E_Y, "\n")
   
   # E[XY]
   E_XY <- 0
   for (i in 1:3) {
     for (j in 1:4) {
       E_XY <- E_XY + i * j * joint_pmf[i, j]
     }
   }
   cat("E[XY] =", E_XY, "\n")
   
   # Covariance
   Cov_XY <- E_XY - E_X * E_Y
   cat("Cov(X,Y) =", Cov_XY, "\n")
   
   # Variances
   E_X2 <- sum((1:3)^2 * marginal_X)
   E_Y2 <- sum((1:4)^2 * marginal_Y)
   Var_X <- E_X2 - E_X^2
   Var_Y <- E_Y2 - E_Y^2
   
   # Variance of sum
   Var_sum <- Var_X + Var_Y + 2 * Cov_XY
   cat("Var(X + Y) =", Var_sum, "\n")

Key Takeaways
-------------

.. admonition:: Summary ðŸ“
   :class: important
   
   â€¢ **Expected value** :math:`E[X] = \sum x \cdot P(X = x)` represents the long-term average
   â€¢ **LOTUS** allows us to find :math:`E[g(X)]` without finding the PMF of :math:`g(X)`
   â€¢ **Linearity of expectation:** :math:`E[aX + b] = aE[X] + b`
   â€¢ **Variance** measures spread: :math:`\text{Var}(X) = E[X^2] - (E[X])^2`
   â€¢ **Properties:** :math:`\text{Var}(aX + b) = a^2\text{Var}(X)`
   â€¢ **Additivity** of expectation always holds; variance additivity requires independence
   â€¢ **Covariance** measures linear relationship: :math:`\text{Cov}(X,Y) = E[XY] - E[X]E[Y]`
